<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ch√∫c m·ª´ng sinh nh·∫≠t!!</title>
    <style>
      :root {
        --accent: #ec4899;
        --bg: #fff7fb;
        --text: #0f172a;
        --muted: #64748b;
        --success: #10b981;
        --danger: #ef4444;
        --card: #ffffff;
      }
      * {
        box-sizing: border-box;
      }
      #giftImg {
        width: 30vw;
        height: 30vw;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
          Arial;
        min-height: 100vh;
        color: var(--text);
        background: var(--bg);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow-x: hidden;
      }

      /* --- Decorative background hearts --- */
      .bg-hearts {
        position: fixed;
        inset: 0;
        overflow: hidden;
        pointer-events: none;
        z-index: 0;
      }
      .bg-hearts span {
        position: absolute;
        display: block;
        width: 14px;
        height: 14px;
        background: radial-gradient(circle at 30% 30%, #ffbcd6, #ec4899);
        transform: rotate(45deg);
        opacity: 0.16;
        filter: blur(0.2px);
        animation: floatUp linear var(--dur) infinite;
        left: var(--x);
        top: 110vh;
      }
      .bg-hearts span::before,
      .bg-hearts span::after {
        content: "";
        position: absolute;
        width: 100%;
        height: 100%;
        background: inherit;
        border-radius: 50%;
      }
      .bg-hearts span::before {
        top: -50%;
      }
      .bg-hearts span::after {
        left: -50%;
      }
      @keyframes floatUp {
        to {
          transform: translateY(-120vh) rotate(45deg);
        }
      }

      /* --- App container --- */
      .question-scene {
        position: relative;
        z-index: 1;
        width: min(920px, 92vw);
      }
      .card {
        background: var(--card);
        border: 1px solid #f1e7ee;
        border-radius: 22px;
        box-shadow: 0 12px 40px rgba(236, 72, 153, 0.12);
        padding: 24px 22px;
        text-align: center;
      }
      .title {
        font-size: clamp(24px, 3.2vw, 34px);
        font-weight: 800;
        color: var(--accent);
        margin: 6px 0 4px;
      }
      .subtitle {
        color: var(--muted);
        font-size: 14px;
      }
      .divider {
        width: 120px;
        height: 10px;
        margin: 14px auto 6px;
        background: conic-gradient(from 0deg, #f9a8d4, #f0abfc, #f9a8d4);
        border-radius: 999px;
        opacity: 0.4;
      }

      .layout {
        display: grid;
        gap: 18px;
        grid-template-columns: 1fr;
        justify-items: center;
      }
      .gift-img {
        width: clamp(180px, 24vw, 240px);
        aspect-ratio: 1/1;
        object-fit: cover;
        border-radius: 22px;
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
        border: 6px solid #fff;
        outline: 2px dashed #ffd1e8;
        outline-offset: 6px;
      }
      .countdown {
        margin-top: 10px;
        font-weight: 700;
        color: var(--muted);
      }

      .question {
        font-size: clamp(18px, 2.2vw, 20px);
        margin: 4px 0 6px;
      }
      .field {
        display: flex;
        gap: 10px;
        justify-content: center;
      }
      input {
        flex: 1;
        padding: 12px 14px;
        max-width: 340px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        font-size: 16px;
      }
      input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px #fde2ef;
      }
      .btn {
        padding: 12px 16px;
        border: none;
        border-radius: 12px;
        background: var(--accent);
        color: #fff;
        font-weight: 700;
        cursor: pointer;
      }
      .btn:hover {
        filter: brightness(1.05);
      }

      /* Progress */
      .progressWrap {
        margin: 10px auto 4px;
        width: min(520px, 90%);
      }
      .progressbar {
        height: 10px;
        background: #f1f5f9;
        border-radius: 999px;
        overflow: hidden;
      }
      .progressbar i {
        display: block;
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #f472b6, #ec4899);
        transition: width 0.25s;
      }
      .progressText {
        font-size: 13px;
        color: var(--muted);
        margin-top: 6px;
      }

      .hint {
        min-height: 22px;
        font-size: 14px;
        margin-top: 8px;
      }
      .hint.ok {
        color: var(--success);
      }
      .hint.err {
        color: var(--danger);
      }

      /* Fullscreen scenes */
      .full-scene {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(255, 247, 251, 0.96);
        z-index: 50;
        padding: 24px;
        overflow: auto;
      }
      .full-scene.show {
        display: block;
        animation: fade 0.35s ease;
      }
      .card-big {
        max-width: 920px;
        margin: 20px auto;
        padding: 40px;
        background: linear-gradient(145deg, #fff, #fff7fb 60%, #ffd7eb);
        border-radius: 24px;
        box-shadow: 0 12px 40px rgba(236, 72, 153, 0.18);
        font-size: 20px;
        line-height: 1.6;
        text-align: center;
      }
      .card-big h2 {
        margin-top: 0;
      }
      img {
        max-width: 100%;
        border-radius: 14px;
      }
      @keyframes fade {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: none;
        }
      }

      /* === Nh√¢n v·∫≠t (·∫£nh c·ªßa b·∫°n c√≥ C√¢n ƒê·∫©u V√¢n) ch·∫°y s√°t ch√¢n trang === */
      #nimbus {
        position: fixed;
        left: 0;
        bottom: 8px;
        height: 54px;
        width: 64px; /* width c·ªë ƒë·ªãnh ƒë·ªÉ lu√¥n c√≥ offsetWidth */
        pointer-events: none;
        z-index: 9;
      }
      #runner {
        position: absolute;
        left: 0;
        bottom: 0;
        height: 54px;
        width: auto;
        display: block;
        object-fit: contain;
        image-rendering: pixelated;
        transform-origin: center;
        transition: transform 0.15s;
      }
    </style>
  </head>
  <body>
    <!-- Floating background hearts -->
    <div class="bg-hearts" aria-hidden="true" id="bgHearts"></div>

    <div class="question-scene" id="quizScene">
      <div class="card">
        <div class="title">üéâ Ch√∫c m·ª´ng sinh nh·∫≠t b·∫°n nh·ªè!!! üéâ</div>
        <div class="subtitle">M·ªôt th·ª≠ th√°ch nho nh·ªè tr∆∞·ªõc khi m·ªü qu√† üíñ</div>
        <div class="divider"></div>

        <div class="layout">
          <img
            class="gift-img"
            id="giftCustom"
            src="./Happy.png"
            alt="H·ªôp qu√† tu·ª≥ ch·ªânh"
          />
          <div class="countdown" id="countdown"></div>
        </div>

        <div class="progressWrap">
          <div class="progressbar"><i id="bar"></i></div>
          <div class="progressText" id="progressText">C√¢u 1/3</div>
        </div>

        <p class="question" id="question"></p>
        <div class="field">
          <input id="answer" type="text" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi..." />
          <button class="btn" id="submitBtn">G·ª≠i</button>
        </div>
        <div id="hint" class="hint"></div>
      </div>
    </div>

    <div class="full-scene" id="cardScene">
      <div class="card-big">
        <h2>üíå Sinh nh·∫≠t th·∫≠t vui v·∫ª nh√©</h2>
        <p>
          üíå "Ch√∫c m·ª´ng sinh nh·∫≠t em ‚Äì ng∆∞·ªùi ƒë·∫∑c bi·ªát nh·∫•t trong cu·ªôc ƒë·ªùi anh!
          C·∫£m ∆°n em v√¨ ƒë√£ ƒë·∫øn b√™n anh, mang ƒë·∫øn ni·ªÅm vui, s·ª± b√¨nh y√™n v√† nh·ªØng
          kho·∫£nh kh·∫Øc ng·ªçt ng√†o. Anh mong r·∫±ng h√¥m nay v√† c·∫£ nh·ªØng ng√†y sau, em
          lu√¥n ƒë∆∞·ª£c bao quanh b·ªüi y√™u th∆∞∆°ng, ti·∫øng c∆∞·ªùi v√† h·∫°nh ph√∫c. Anh s·∫Ω
          lu√¥n n·∫Øm tay em, c√πng em ƒëi qua m·ªçi kh√≥ khƒÉn, v√† c√πng nhau vi·∫øt ti·∫øp
          c√¢u chuy·ªán th·∫≠t ƒë·∫πp c·ªßa ch√∫ng ta. Y√™u em nhi·ªÅu l·∫Øm!" üíñüéÇ‚ú®
        </p>
        <p><b>B·∫•y b√¨ c√≥ ƒëo√°n ƒë∆∞·ª£c m√≥n qu√† nƒÉm nay l√† g√¨ kh√¥ng! üéâ</b></p>
        <button class="btn" id="toGiftBtn">Xem ph·∫ßn qu√† ‚ñ∂</button>
      </div>
    </div>

    <div class="full-scene" id="giftScene">
      <div class="card-big">
        <h2>üéÅ Ph·∫ßn qu√† c·ªßa b·∫°n</h2>
        <img id="giftImg" src="" alt="·∫¢nh ph·∫ßn qu√†" />
        <div style="margin-top: 16px">
          <button class="btn" id="restartBtn">Ch∆°i l·∫°i</button>
        </div>
      </div>
    </div>

    <!-- Nh√¢n v·∫≠t c·ªßa b·∫°n (·∫£nh ƒë√£ c√≥ C√¢n ƒê·∫©u V√¢n) -->
    <div id="nimbus">
      <!-- Thay runner.png b·∫±ng ·∫£nh c·ªßa b·∫°n -->
      <img id="runner" src="./me.png" alt="nh√¢n v·∫≠t tr√™n m√¢y" />
    </div>

    <script>
      // ===== Questions & helpers =====
      const QUESTIONS = [
        { q: "1) B·∫°n c√≥ y√™u ng∆∞·ªùi t·∫∑ng kh√¥ng?", answer: ["c√≥", "co", "yes"] },
      ];
      const norm = (s) =>
        (s || "")
          .normalize("NFD")
          .replace(/\p{Diacritic}+/gu, "")
          .trim()
          .toLowerCase();
      const matchAnswer = (i, arr) => arr.some((a) => norm(i) === norm(a));

      let index = 0;
      const qEl = document.getElementById("question");
      const aEl = document.getElementById("answer");
      const hint = document.getElementById("hint");
      const bar = document.getElementById("bar");
      const progressText = document.getElementById("progressText");

      function updateProgress() {
        progressText.textContent = `C√¢u ${Math.min(
          index + 1,
          QUESTIONS.length
        )}/${QUESTIONS.length}`;
        bar.style.width = Math.min(index / QUESTIONS.length, 1) * 100 + "%";
      }
      function showQ() {
        if (index < QUESTIONS.length) {
          qEl.textContent = QUESTIONS[index].q;
          aEl.value = "";
          hint.textContent = "";
        } else {
          document.getElementById("quizScene").style.display = "none";
          document.getElementById("cardScene").classList.add("show");
          burstConfetti(900);
        }
        updateProgress();
      }
      function submit() {
        if (index >= QUESTIONS.length) return;
        if (matchAnswer(aEl.value, QUESTIONS[index].answer)) {
          hint.textContent = "‚úî ƒê√∫ng r·ªìi!";
          hint.className = "hint ok";
          index++;
          setTimeout(showQ, 280);
        } else {
          hint.textContent = "‚úò Sai r·ªìi, th·ª≠ l·∫°i nh√©!";
          hint.className = "hint err";
        }
      }
      document.getElementById("submitBtn").onclick = submit;
      aEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter") submit();
      });

      document.getElementById("toGiftBtn").onclick = () => {
        document.getElementById("cardScene").classList.remove("show");
        document.getElementById("giftScene").classList.add("show");
        document.getElementById("giftImg").src = "./gift.jpg";
      };
      document.getElementById("restartBtn").onclick = () => {
        index = 0;
        document.getElementById("giftScene").classList.remove("show");
        document.getElementById("quizScene").style.display = "block";
        showQ();
      };

      // ===== Countdown to birthday 16/8 =====
      function updateCountdown() {
        const now = new Date();
        const year =
          now.getMonth() > 7 || (now.getMonth() === 7 && now.getDate() > 16)
            ? now.getFullYear() + 1
            : now.getFullYear();
        const bday = new Date(year, 7, 16);
        const diff = Math.ceil((bday - now) / (1000 * 60 * 60 * 24));
        document.getElementById(
          "countdown"
        ).textContent = `C√≤n ${diff} ng√†y n·ªØa t·ªõi sinh nh·∫≠t b·∫°n Honkane <3`;
      }
      updateCountdown();

      // ===== Background hearts =====
      (function hearts() {
        const root = document.getElementById("bgHearts");
        const N = 28;
        const rnd = (a, b) => Math.random() * (b - a) + a;
        for (let i = 0; i < N; i++) {
          const s = document.createElement("span");
          s.style.setProperty("--x", Math.round(rnd(0, 100)) + "vw");
          s.style.setProperty("--dur", Math.round(rnd(10, 22)) + "s");
          s.style.animationDelay = -rnd(0, 22) + "s";
          const size = Math.round(rnd(10, 18)) + "px";
          s.style.width = size;
          s.style.height = size;
          root.appendChild(s);
        }
      })();

      // ===== Confetti =====
      function burstConfetti(duration = 1000) {
        const canvas = document.createElement("canvas");
        canvas.width = innerWidth;
        canvas.height = innerHeight;
        canvas.style.cssText =
          "position:fixed;inset:0;z-index:60;pointer-events:none;";
        document.body.appendChild(canvas);
        const ctx = canvas.getContext("2d");
        const pieces = Array.from({ length: 160 }, () => ({
          x: Math.random() * canvas.width,
          y: -20 - Math.random() * canvas.height,
          w: 6 + Math.random() * 6,
          h: 8 + Math.random() * 10,
          vy: 2 + Math.random() * 3,
          vx: -2 + Math.random() * 4,
          rot: Math.random() * Math.PI,
          vr: -0.2 + Math.random() * 0.4,
          col: `hsl(${Math.floor(Math.random() * 360)},90%,60%)`,
        }));
        let start = performance.now();
        (function tick(t) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          pieces.forEach((p) => {
            p.x += p.vx;
            p.y += p.vy;
            p.rot += p.vr;
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.rot);
            ctx.fillStyle = p.col;
            ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
            ctx.restore();
            if (p.y > canvas.height + 40) {
              p.y = -20;
              p.x = Math.random() * canvas.width;
            }
          });
          if (t - start < duration) requestAnimationFrame(tick);
          else canvas.remove();
        })(start);
      }

      // ===== Nh√¢n v·∫≠t ch·∫°y: ch·ªâ ƒë·ªïi v·ªã tr√≠ qua l·∫°i, ch·ªù ·∫£nh load =====
      const nimbus = document.getElementById("nimbus");
      const runner = document.getElementById("runner");
      let x = 0;
      let dir = 1;
      const speed = 0.8; // px/frame

      function startRunner() {
        // ƒë·∫£m b·∫£o container c√≥ width ƒë√∫ng (d·ª±a theo ·∫£nh) nh∆∞ng v·∫´n c√≥ fallback 64px
        const w = runner.getBoundingClientRect().width || 64;
        nimbus.style.width = Math.round(w) + "px";

        function step() {
          const maxX = window.innerWidth - nimbus.offsetWidth;
          x += speed * dir;
          if (x <= 0) {
            x = 0;
            dir = 1;
            runner.style.transform = "scaleX(1)";
          }
          if (x >= maxX) {
            x = maxX;
            dir = -1;
            runner.style.transform = "scaleX(-1)";
          }
          nimbus.style.left = x + "px";
          requestAnimationFrame(step);
        }
        step();
      }

      if (runner.complete) {
        // ·∫¢nh ƒë√£ cache s·∫µn
        startRunner();
      } else {
        runner.addEventListener("load", startRunner);
        runner.addEventListener("error", () => {
          // v·∫´n ch·∫°y container ƒë·ªÉ b·∫°n th·∫•y khung v·ªã tr√≠ (n·∫øu mu·ªën, b·ªè d√≤ng d∆∞·ªõi)
          nimbus.style.outline = "1px dashed #fda4af";
          startRunner();
        });
      }

      showQ(); // start quiz
      // hearts + countdown ƒë√£ ch·∫°y ·ªü tr√™n
    </script>
  </body>
</html>
